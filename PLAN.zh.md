# 项目开发计划

> **语言 (Language)**: [English](PLAN.md) | 简体中文

## 概述

本文档概述了 **Claude Code 最佳实践** 项目的综合开发路线图。该计划分为七个不同的阶段，每个阶段都在前一个阶段的基础上构建，旨在为专业开发人员创建生产级资源。

---

## 阶段 0：项目结构规划 ✅ 已完成

**目标**：定义完整的项目架构并建立核心原则。

### 交付物

- [x] 完整的目录结构设计
- [x] 核心文件职责映射
- [x] 技术栈选择（Node.js）
- [x] 安全策略概述
- [x] 文档架构规划

### 关键决策

- **技术栈**：Node.js >= 18.0.0, ESLint, Prettier, 测试框架 Jest
- **安全模型**：基于拒绝列表的显式文件保护
- **文档方法**：渐进式披露（初学者 → 高级）
- **示例策略**：实际可运行代码而非理论示例

---

## 阶段 1：基础设置 ✅ 已完成

**目标**：创建基本的项目基础设施和元文件。

### 任务

- [x] 创建 README.md，包含全面的项目概述
- [x] 添加 MIT LICENSE
- [x] 为 Node.js 项目配置 .gitignore
- [x] 编写 PLAN.md（本文档）
- [x] 初始化 package.json，包含项目元数据
- [x] 创建 CONTRIBUTING.md，包含贡献指南

### 成功标准

- 项目可以被克隆并被新贡献者理解
- 基本的 npm 项目结构功能正常
- 许可证和贡献指南清晰明确

---

## 阶段 2：核心配置文件

**目标**：构建项目核心 - 生产就绪的 Claude Code 配置。

### 任务

#### 2.1 创建 `.claude/CLAUDE.md`

- [ ] 编写项目上下文部分
  - 项目目标和架构
  - 技术栈概述
  - 开发理念（TDD、安全优先等）
- [ ] 定义编码标准
  - JavaScript/TypeScript 风格指南
  - 命名约定（camelCase、PascalCase 规则）
  - 文件组织模式
  - 导入排序规则
- [ ] 记录常用 Bash 命令
  - Git 工作流程（分支、提交、合并、变基）
  - npm/yarn 命令（安装、测试、构建、部署）
  - Docker 命令（如适用）
  - 测试命令
- [ ] 创建 TDD 指令模板
  - 红-绿-重构循环提示
  - 单元测试优先方法
  - 集成测试模式
  - 测试命名约定
- [ ] 定义工作流程
  - 功能开发工作流程
  - Bug 修复工作流程
  - 代码审查工作流程
  - 发布工作流程

#### 2.2 配置 `.claude/settings.json`

- [ ] 配置拒绝列表
  - 环境文件（.env, .env.*）
  - 凭证（*.pem, *.key, credentials.json）
  - 构建产物（dist/, node_modules/）
  - IDE 特定文件
- [ ] 设置允许的工具
  - 文件操作（Read, Write, Edit）
  - 搜索工具（Grep, Glob）
  - 执行（带限制的 Bash）
- [ ] 定义钩子（如适用）
  - Pre-commit: lint + test
  - Pre-push: 完整测试套件
- [ ] 设置令牌优化首选项

#### 2.3 设置 `.claudeignore`

- [ ] 创建全面的排除列表
  - 密钥和凭证
  - 第三方代码（node_modules）
  - 构建输出
  - 大型二进制文件
  - 缓存目录
- [ ] 为每个排除项添加内联注释说明
- [ ] 使用真实项目结构进行测试

### 成功标准

- Claude Code 正确遵守文件边界
- 可以使用 CLAUDE.md 模板执行 TDD 工作流程
- 安全敏感文件完全无法访问
- 配置文档完善且自解释

---

## 阶段 3：自定义命令实现

**目标**：构建三个生产就绪的斜杠命令，以自动化常见工作流程。

### 3.1 `/review` 命令

**目的**：全面的代码审查自动化

#### 实现细节

- [ ] 创建 `.claude/commands/review.sh`
- [ ] 实现分析模块：
  - **安全检查**：SQL 注入、XSS、硬编码密钥
  - **性能分析**：O(n²) 算法、不必要的循环、内存泄漏
  - **最佳实践**：SOLID 原则、DRY 违规、错误处理
  - **代码风格**：与项目标准的一致性
- [ ] 生成结构化输出：
  - 严重程度级别（关键、高、中、低、信息）
  - 文件和行号引用
  - 建议的修复及代码示例
- [ ] 集成选项：
  - Pre-commit 钩子集成
  - CI/CD 管道兼容
  - JSON 输出用于工具集成

#### 测试用例

- [ ] 审查带有故意安全漏洞的代码
- [ ] 审查存在性能问题的代码
- [ ] 审查编写良好的代码（应该顺利通过）

### 3.2 `/fix-lint` 命令

**目的**：自动化代码检查和格式化

#### 实现细节

- [ ] 创建 `.claude/commands/fix-lint.sh`
- [ ] 检测 linter 配置（ESLint, Prettier, StandardJS）
- [ ] 对可修正的问题运行自动修复
- [ ] 报告无法修复的问题并提供指导
- [ ] 支持：
  - JavaScript/TypeScript
  - JSON 配置文件
  - Markdown 文档
- [ ] 选项：
  - `--dry-run`：预览更改而不应用
  - `--strict`：对警告失败
  - `--staged`：仅检查暂存文件

#### 测试用例

- [ ] 修复常见的检查错误（缺少分号、间距）
- [ ] 优雅处理有语法错误的文件
- [ ] 保留代码块中的有意格式

### 3.3 `/conventional-commit` 命令

**目的**：生成标准化的提交消息

#### 实现细节

- [ ] 创建 `.claude/commands/conventional-commit.sh`
- [ ] 使用 `git diff --staged` 分析暂存的更改
- [ ] 检测提交类型：
  - `feat`：新功能
  - `fix`：Bug 修复
  - `docs`：文档更改
  - `style`：格式更改
  - `refactor`：代码重构
  - `test`：测试添加/修改
  - `chore`：维护任务
- [ ] 从文件路径生成作用域
- [ ] 创建简洁、描述性的提交正文
- [ ] 如适用，添加破坏性更改通知
- [ ] 格式：

  ```
  <type>(<scope>): <subject>

  <body>

  <footer>
  ```

#### 测试用例

- [ ] 单文件更改的提交
- [ ] 多个相关更改的提交
- [ ] 带有破坏性更改的提交

### 成功标准

- 所有三个命令都可执行且功能正常
- 命令与 Claude Code 无缝集成
- 为无效状态提供清晰的错误消息
- 为每个命令提供全面的文档

---

## 阶段 4：代码审查代理

**目标**：创建用于深度代码分析的专用子代理。

### 任务

#### 4.1 代理配置

- [ ] 创建 `.claude/agents/code-reviewer/` 目录
- [ ] 编写 `AGENT.md`，包含代理指令：
  - 代理目的和功能
  - 分析方法论
  - 输出格式规范
  - 与 `/review` 命令的集成

#### 4.2 分析模块

- [ ] **安全模块**
  - OWASP Top 10 漏洞检测
  - 依赖项漏洞扫描
  - 认证/授权检查
  - 输入验证分析
- [ ] **架构模块**
  - 设计模式识别
  - 依赖项分析（循环依赖、耦合）
  - 关注点分离评估
  - 可扩展性评估
- [ ] **性能模块**
  - 算法复杂度分析
  - 数据库查询优化
  - 缓存机会
  - 包大小影响
- [ ] **可维护性模块**
  - 代码复杂度指标（圈复杂度、认知复杂度）
  - 测试覆盖率差距
  - 文档完整性
  - 代码重复检测

#### 4.3 报告系统

- [ ] 结构化 JSON 输出格式
- [ ] 人类可读的摘要报告
- [ ] 可操作的建议及示例
- [ ] 基于严重程度的优先级排序

### 成功标准

- 代理提供可操作、准确的反馈
- 报告清晰且对开发人员友好
- 可以独立调用或通过 `/review` 调用
- 高效处理大型代码库

---

## 阶段 5：文档编写

**目标**：创建全面的生产级文档。

### 5.1 入门指南（`docs/01-getting-started.md`）

- [ ] 安装说明
  - 先决条件
  - Claude Code CLI 安装
  - 项目设置
- [ ] 快速入门教程
  - 第一个项目配置
  - 运行基本命令
  - 理解 Claude Code 工作流程
- [ ] 常见问题故障排除

### 5.2 安全最佳实践（`docs/02-security-best-practices.md`）

- [ ] 拒绝列表配置策略
- [ ] 密钥管理
  - 环境变量
  - 密钥扫描工具
  - 轮换策略
- [ ] 权限边界
  - 工具限制
  - 文件访问控制
  - 网络访问策略
- [ ] 审计日志
  - 记录什么
  - 日志保留
  - 合规性考虑
- [ ] CI/CD 安全集成

### 5.3 令牌优化（`docs/03-token-optimization.md`）

- [ ] 上下文窗口管理
  - 增量编辑 vs 完全重写
  - 选择性文件读取
  - 摘要策略
- [ ] 高效提示
  - 具体而非冗长
  - 使用引用而非重复
  - 利用 CLAUDE.md 上下文
- [ ] 大型代码库策略
  - 模块化架构
  - 代理专业化
  - 缓存模式
- [ ] 测量和监控
  - 令牌使用跟踪
  - 成本优化

### 5.4 Git 工作流集成（`docs/04-git-workflow.md`）

- [ ] 分支策略
  - Git Flow
  - GitHub Flow
  - 主干开发
- [ ] 提交消息标准
  - 约定式提交
  - 语义化版本集成
- [ ] PR 模板和自动化
  - PR 描述模板
  - 自动化审查
  - 合并策略
- [ ] 钩子集成
  - Pre-commit: 检查、测试
  - Pre-push: 集成测试
  - Commit-msg: 格式验证

### 5.5 提示工程（`docs/05-prompt-engineering.md`）

- [ ] 有效的指令模式
  - 分步 vs 整体
  - 上下文提供
  - 约束规范
- [ ] TDD 提示策略
- [ ] 调试和错误解决
- [ ] 重构模式
- [ ] 要避免的反模式

### 5.6 高级用法（`docs/06-advanced-usage.md`）

- [ ] 自定义钩子实现
- [ ] MCP 服务器集成
- [ ] IDE 扩展开发
- [ ] 多代理编排
- [ ] 性能分析
- [ ] 自定义工具创建

### 成功标准

- 文档清晰、准确且可操作
- 示例可运行且经过测试
- 涵盖从初学者到高级的用例
- 包含真实场景和解决方案

---

## 阶段 6：TDD 示例开发

**目标**：创建一个完整的、可运行的示例，演示测试驱动开发。

### 6.1 项目设置（`examples/tdd-demo/`）

- [ ] 初始化 Node.js 项目
- [ ] 配置测试框架（Jest）
- [ ] 设置 ESLint 和 Prettier
- [ ] 创建此示例的特定 `.claude/` 配置
- [ ] 编写全面的 README

### 6.2 功能：Todo API 实现

**功能**：用于管理待办事项的 RESTful API

#### 需求

- [ ] 创建待办事项（POST /todos）
- [ ] 列出待办事项（GET /todos）
- [ ] 获取单个待办事项（GET /todos/:id）
- [ ] 更新待办事项（PUT /todos/:id）
- [ ] 删除待办事项（DELETE /todos/:id）
- [ ] 标记为完成（PATCH /todos/:id/complete）

#### TDD 工作流程演示

**迭代 1：创建待办事项**

- [ ] 为 POST /todos 编写失败测试
- [ ] 实现通过测试的最小代码
- [ ] 重构以提高清晰度
- [ ] 在 README 中记录过程

**迭代 2：列出待办事项**

- [ ] 为 GET /todos 编写失败测试
- [ ] 实现功能
- [ ] 重构（提取存储库模式）

**迭代 3：获取单个待办事项**

- [ ] 编写测试（正常路径 + 404 情况）
- [ ] 实现错误处理
- [ ] 重构

**迭代 4-6**：对更新、删除、完成重复

#### 测试层

- [ ] 业务逻辑的单元测试
- [ ] API 端点的集成测试
- [ ] 完整工作流程的 E2E 测试
- [ ] 测试覆盖率报告（目标 >90%）

### 6.3 文档

- [ ] `examples/tdd-demo/README.md` 中的分步 TDD 指南
- [ ] 解释测试结构的内联注释
- [ ] 显示红-绿-重构循环的提交历史
- [ ] 回顾：经验教训

### 成功标准

- 示例可以独立克隆和运行
- 所有测试通过
- 展示清晰的 TDD 进展
- 代码干净且文档完善
- 可用作新项目的模板

---

## 阶段 7：模板提取和优化

**目标**：创建可重用模板并完善整个项目。

### 7.1 模板创建

- [ ] `templates/CLAUDE.md.template`
  - 参数化部分（项目名称、技术栈）
  - 自定义指南
  - 变量占位符
- [ ] `templates/tdd-workflow.md`
  - 通用 TDD 流程
  - 测试命名模板
  - 提交消息模板
- [ ] `templates/pr-review-checklist.md`
  - 安全检查
  - 性能检查
  - 代码质量检查
  - 文档检查

### 7.2 项目完善

- [ ] 审查所有文档的一致性
- [ ] 确保所有代码示例都经过测试
- [ ] 向 README 添加徽章（CI 状态、覆盖率、许可证）
- [ ] 创建 GitHub 问题模板
- [ ] 为 CI 设置 GitHub Actions
  - 运行测试
  - 检查检查
  - 文档中的链接验证
- [ ] 创建发布工作流程

### 7.3 社区准备

- [ ] 编写全面的 CONTRIBUTING.md
  - 行为准则
  - 开发设置
  - PR 提交流程
  - 问题分类
- [ ] 为首次贡献创建示例问题
- [ ] 设置讨论论坛
- [ ] 准备公告博客文章/推文

### 成功标准

- 项目功能齐全且文档完善
- 模板易于使用和自定义
- 所有 CI 检查通过
- 准备好公开发布和接受贡献

---

## 时间表和里程碑

### 第一阶段：基础（阶段 1-2）

**目标**：第 1-2 周

- 交付物：具有核心配置的功能项目结构

### 第二阶段：自动化（阶段 3-4）

**目标**：第 3-4 周

- 交付物：工作命令和代码审查代理

### 第三阶段：知识（阶段 5-6）

**目标**：第 5-7 周

- 交付物：完整文档和 TDD 示例

### 第四阶段：完善（阶段 7）

**目标**：第 8 周

- 交付物：准备好公开发布

---

## 成功指标

1. **采用率**：第一个月获得 100+ GitHub 星标
2. **参与度**：10+ 社区贡献
3. **质量**：90%+ 测试覆盖率，零关键安全问题
4. **文档**：所有文档经过 3+ 开发人员审查和批准
5. **可用性**：新用户可在 <15 分钟内完成设置

---

## 风险缓解

| 风险                     | 可能性 | 影响 | 缓解措施                            |
| ------------------------ | ------ | ---- | ----------------------------------- |
| Claude Code API 更改     | 中     | 高   | 版本锁定，维护兼容层                |
| 示例中的安全漏洞         | 低     | 高   | 发布前安全审查，依赖项扫描          |
| 范围蔓延                 | 高     | 中   | 严格遵守计划，推迟次要功能          |
| 文档漂移                 | 中     | 中   | 自动化文档测试，定期审查            |

---

## 未来考虑（发布后）

- **多语言支持**：Python、Go、Rust 示例
- **高级代理**：数据库优化器、安全审计器
- **IDE 插件**：用于快速模板插入的 VS Code 扩展
- **视频教程**：关于最佳实践的 YouTube 系列
- **企业指南**：团队协作模式、SOC2 合规性

---

## 更改日志

| 日期       | 阶段 | 更改                | 原因         |
| ---------- | ---- | ------------------- | ------------ |
| 2026-01-06 | 1    | 初始化 PLAN.md      | 项目启动     |

---

**下一步**：完成阶段 1，然后继续创建 `.claude/CLAUDE.md` 的阶段 2。
